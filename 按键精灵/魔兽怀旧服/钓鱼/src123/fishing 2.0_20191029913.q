[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=176c1a3c-7150-4338-ab1f-7e5d2a487114
Description=fishing 2.0
Enable=0
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=2
QUI=
[Relative]
SetupOCXFile=
[Comment]

[Attachment]
UEsDBBQAAgAIAPhkXE+nOzDa7wMAAOYEAAAMABEAZmlzaGxvZ28uYm1wVVQNAAeQ4bZdm+G2XY/htl1N0dtP21YcwHGSOM5xYhPnRgzOQpyEQO5xEsidGDchJCkQbimEy5pSegFWIIJuKh3V1K2b1q0PU9eHtms3tk4qWqX2bdIm9W3lcS8r07TuaZq2/2I/YoQ4+h4/2Pro2D+Lw/9gLc3VB7sHtvFoy1qY5v3nR89PrlQmmckelkzHIr3h41JSySTUn0qKGakUlIn1StEYktJjyNysQ6mGq0mpMSnV0iMthjSyw5BMCeFyBSE7XHa9t02pgRilhj2RdNOAqfWYWoepJS5ZpUwOyVtaBF/dqCQ78FYL0nKkoVOjs+CH2ai3vGzMbvRYKNaoUBkwpFMgtRwnZDguU0BYi2yz9r1Lz3kYR38wtnr+4sriBZfBnejOjmQ/KMTWZ4bun05eS7gqDIagVgUi5Ueny2XyxvRudaC69/XTbCDBGRm7qUPky5DgW5jIf14rPqgVH06JtyVLN/mxraSm3537lrN2Mc3l7YlmgvVi4tq5yu7i2JPJ7J3VhW/mS3c5REMwAT1GaDEVpVAihdLDcvfWfq1klrO9lfzA9OnCYpZfGhNujwtXR9PvTAmfrS9+d6H6QLKsigLenLwKbLe1+/Env6yf+TJqK6Y8/WKoUexbnRI+NhlNP/70Yji+Odm/faPxxI1oyKqiLDgJkwcORz+6/yhkqdTEnT57VQjUs/75Svr6YHQJITRRGd258tVI/OrqzEeS5ZrcgMG/04D16MNxgs3Y8mLovOidFyMbo7H3xNBFm9Wm0+l+f/NfTTg7mRgLEG1+os2FDMDbcdLUfHO/qVcMLyUpLtNqF828GG0IwaWweyLgDeA4fvDnv/02wUc4IpoO4N3IYEe64692UV0pblCMXsloHXmay3GD4Z4q3zMV8vSpkOrgj78HHKJP5YyoO4KEGWwX0rM4yTTth7duRGg27Z4pcIMlmivS9rBzjO+pJXwlRKLXB3+V3OUo5ecRA7kJo5swwCezTdtYW+FJJukczkeWSzp7kebilLXXHEn4igSJfnv9ZqO6Vc81yr7ZsNriRnqwNqSVbFBrHiBtGWO4fOr9kfCsSHKFVkeO4rraLQxJv/z55eXqp1PCzfmhu7OFL/KxSzArBjsMRg2TBwtkKHpuUtySLORirU7GAnaxcms8vTNz6s7a/PPa2EMxUnfS3ZLlaSZBsQlCL3K58dxWAnE5rQPymzm/2b7/6lXeEYqb+XJqfWHi8fLZH1bqz0aHtjsNThojTtq5mXtgs5QVAhtknfv7+2ADBOMmmVJqvZTevvz23srSs0rxenurMeePuxHjQcxIfO5MejZMcmnKCvGGTt7p2d17Kti9MEy/2shhRD5yqZzYBAttrLz4H1BLAQIXCxQAAgAIAPhkXE+nOzDa7wMAAOYEAAAMAAkAAAAAAAAAIACAgQAAAABmaXNobG9nby5ibXBVVAUAB5Dhtl1QSwUGAAAAAAEAAQBDAAAAKgQAAAAA


[UIPackage]
UEsDBBQAAgAIAIR7bk+/KJP8bwMAAAgkAAAJABEAVUlQYWNrYWdlVVQNAAeycs1dsnLNXbJyzV3tWMtOU0EY/k7LpRco5VaQm/WCsjHRvTFaIokGL6EFExcmBYs0lkJOMWLc+BzuXLvyAXwG3Rhd6gOYsHIn9TvnzLFTUsKZmQNNk37kZ8qhc76Zf/7rROHh65fhnx8+Tf3CEdxCFIf1OPqkZ5YQF2kgIv4+rNfr/uN6Fx2Fv5QecYbOWfdS+ilxSoySoAxSkpQBSso7egyJOYddFXY0VrDDnz1kcRdVjjbeQAUZWoz/LuuE774rf1/4/P6bFeXn2zHv2Sru4Tr0EYNl+fyRE3j9Uf7fIgpYNlhBQvBPCN9R5S9Q37so4SGK2OaoihFEXP5hEXuDzusRo+/D7ZQu2oelHXvbwP2wVK5tmbzDghlM55tik/s3ma/gsqcyXzfuNOJfpKnmC3pmIvy7WaeIdVQ015Bi/EuKOiUof0SKf2soo0bRXUFaY/9RiX+FrEU8xyPqoaKYe/34PyDeGZS/R+IvkH+fed/g/C3V/fdK/IusPioUW3MlYxr8fS35czyHDbxU53fr5SEF/fcfOf8NQ/0PCn8Kyh+DV8PLuEanuN/uYKqB/jbz/2mtc1eTD/LZfLFay+ZLdnnzlPjnPz4zmv+Ukcdm/Cnxtw6c+DsufCqo/cUl+1+m76l7XbP9p8X7gvInWvp/nuvYoh7UsuEk/X8UThwOzp+U+O+w+t91c4BNqXINalkow/3H4fXlQfkHJP4l7r1qFn+U858Tr27+33+F2fcF1+DovaoT/5X5U03nX6T+97gGRw859xz8TNCwjeOxQP1n0Lj3CsI/JPHn3Pd7/heEr4X9WWOK/GmJ3zR+mNafpnhSWs/ZO69rJdt0/g2t+Z3evxRo+Xtu7atjfW78Ufa/Ycn+HpN/n+wVVuE6SGnwjxzhd+qvV9y3zi3MpAa/fF/u3T/p2Z6DBC3I55465jtncf+ksv9ReDnYQQj9pzK/Ey+T4nMY/WeW43kEz7/jCLX/tC5ALf5nEGr/iWnXD4LvfwLt7T+b/e/s+89JhNp/WjMcLyvo/5zEb4qDgwOz+T/qdUfeMir91igmomgvTPlN879p/xnG/cNFjrMK9jeFxv1DCP2ncv6dRqj9J+aFTwXln0Go/ad1BWrxfxah9p+Y43hJYf9zCLX/tK4q7t/J1X7/GUL/pWx/WWn/q/TAZQP/jxnWn6b9XxedjX9QSwECFwsUAAIACACEe25PvyiT/G8DAAAIJAAACQAJAAAAAAAAAAAAAIAAAAAAVUlQYWNrYWdlVVQFAAeycs1dUEsFBgAAAAABAAEAQAAAAKcDAAAAAA==


[Script]
//------------------------------------------------
//配置 Config  目录
//------------------------------------------------
ConfigPathErrorFile="C:\fishing"
ConfigPath = ConfigPathErrorFile & "\"
Exist = Plugin.File.ExistFile(ConfigPathErrorFile)
If Exist = 0 Then 
    Call Plugin.File.CreateFolder(ConfigPath)
ElseIf Exist = 1 Then
    MessageBox "请删除文件 " & ConfigPathErrorFile
    Goto endflag
End If


//------------------------------------------------
//license 检查
//------------------------------------------------
GetSN = Plugin.Sys.GetHDDSN()
GetSNMD5 = Plugin.Encrypt.Md5String(GetSN)

IsFile = Plugin.File.IsFileExist(ConfigPath & "fishing.reg")
If not IsFile Then 
    MessageBox "找不到 license ！"
    //写入注册码
    IsFile = Plugin.File.IsFileExist(ConfigPath & "fishing.reg")
    If not IsFile  Then 
        reg_handle = Plugin.File.OpenFile(ConfigPath & "fishing.reg")
        Call Plugin.File.WriteFile(reg_handle,GetSNMD5)
        Call Plugin.File.CloseFile(reg_handle)
    End If

		
    Goto endflag
End If

//读取license
lic_handle = Plugin.File.OpenFile(ConfigPath & "fishing.lic")
license = Plugin.File.ReadFile(lic_handle, 32)
license = UCase(license)
Call Plugin.File.CloseFile(lic_handle)

//计算正确的license
license_answer = Plugin.Encrypt.Md5String(GetSNMD5 & "whoisyourdaddy")
license_answer = UCase(license_answer)

//验证 license
If license = license_answer Then 
    //	MessageBox "验证成功！"
Else 
    MessageBox "license 验证失败！"
    Goto endflag
End If


//全局使用的变量
scrw = Plugin.Sys.GetScRX()
scrh = Plugin.Sys.GetScRY()



//------------------------------------------------
//函数定义
//------------------------------------------------

Dim FindX
Dim FindY
Function Find(x1, y1, x2, y2, colors, t, p)

    Find = -1
    
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), t, p, x, y
        If x > 0 And y > 0 Then
            Find = i
            FindX = x
            FindY = y
            //MessageBox FindX
            Exit Function
        End If
    Next
End Function




//------------------------------------------------
//配置查找色
//------------------------------------------------
RedFeatherColor = "121215|141B2E|081C8C|1B266A|0F4BCB|0B0F26|090F2C"
YellowCorkWoodColor = "72A089|89BDB0|3191B5|7398BD|3C8EB8|45A7C6|499694|48678B|3D609F|314884"
HighlightYellowCorkWood = "98DEFB|BEFEFF|9FD6F5|7FB4DF|647397|6D91D2|6595EE|6397EC|55C4F2|6BDAFE|62C7E9|5DC2E7|7198B0|689AC1|5BAFD0"


IsFile = Plugin.File.IsFileExist(ConfigPath & "fishing.ini")
If not IsFile  Then 
    //红色羽毛
    Call Plugin.File.WriteINI("Color", "RedFeather",RedFeatherColor , ConfigPath & "fishing.ini")
    //黄色轻木
    Call Plugin.File.WriteINI("Color", "YellowCorkWood",YellowCorkWoodColor , ConfigPath & "fishing.ini")
    //高亮的黄色轻木
    Call Plugin.File.WriteINI("Color", "HighlightYellowCorkWood",HighlightYellowCorkWood , ConfigPath & "fishing.ini")
End If

RedFeather = Plugin.File.ReadINI("Color", "RedFeather", ConfigPath & "fishing.ini")
YellowCorkWood = Plugin.File.ReadINI("Color", "YellowCorkWood", ConfigPath & "fishing.ini")
HighlightYellowCorkWood = Plugin.File.ReadINI("Color", "HighlightYellowCorkWood", ConfigPath & "fishing.ini")

//浮漂的红色羽毛
aRedFeather = Split(RedFeather, "|")
//浮漂的黄色轻木
aYellowCorkWood = Split(YellowCorkWood, "|")
//高亮的浮漂的黄色木块 鼠标落上高亮
aHighlightYellowCorkWood = Split(HighlightYellowCorkWood, "|")



//------------------------------------------------
//配置查找色
//------------------------------------------------


Rem begin

//鼠标移动到左下角
MoveTo 50 + Int(Rnd * 50), scrh - 50 - Int(Rnd * 50)
Delay 500 + Int(Rnd * 500)

//KeyPress "F11", 1

FindPic 0, Int(scrh * 3 / 4), scrw, scrh, "Attachment:\fishlogo.bmp", 0.5, intX, intY
If intX > 0 And intY > 0 Then 
    MoveTo intX + Int(Rnd * 10),intY + Int(Rnd * 10)
    LeftClick 1
    Delay 1000 + Int(Rnd * 2000)
    //    MoveTo Int(Rnd * 1000), Int(Rnd * 500)
Else 
    MessageBox "没找到钓鱼图标，请拖到默认动作条最右一格附近！"
    Goto endflag
End If

//MoveTo 650+Int(Rnd * 20),740+Int(Rnd * 20)
//LeftClick 1
//
//暴力查找浮漂的循环
//For msx = 800 To 400 Step -20
//    For msy = 600 To 250 Step -1
//        MoveTo msx, msy
//        ms = GetCursorShape(0)
//        //如果找到鱼漂就跳出
//        If ms = 1884068285 Then Goto wait
//    Next
//Next
//Rem wait


//Delay 1000 + Int(Rnd * 2000)

//找浮漂红色部分
rx1 = Int(scrw / 3)
ry1 = Int(scrh / 3)
rx2 = Int(scrw * 2 / 3)
ry2 = Int(scrh - 200)
F = Find(rx1, ry1, rx2, ry2, aRedFeather, 1, 0.8)
If F >= 0 Then 
    
    rfx = FindX
    rfy = FindY
    
    //鼠标如果进行了这个移动操作，说明找到红色羽毛了
    //鼠标移动到浮漂右下角
    MoveTo rfx + 50 + Int(Rnd * 50), rfy + 50 + Int(Rnd * 50)
    Delay 500 + Int(Rnd * 500)

	
	
    //浮漂黄色部分
    F = Find(rfx, rfy, rfx + 50, rfy + 50, aYellowCorkWood, 2, 0.8)
    If F >= 0 Then 
        ycwx = FindX
        ycwy = FindY
        MoveTo ycwx+3, ycwy+3

    End If
	
End If



Delay Int(Rnd * 1000)

//通过检测鼠标样式，判断鼠标是否落在浮漂上
ms = GetCursorShape(0)
If Not ms = 1884068285  Then Goto begin


starttime = Second(Time)

While True

    F = Find(ycwx - 10, ycwy - 10, ycwx + 10, ycwy + 10, aHighlightYellowCorkWood, 0, 0.8)
    If F < 0  Then 
        Goto success
    End If

    
    //如果没鱼上钩，30秒后重新抛竿
    nowtime = Second(Time)
    If nowtime < starttime Then 
        nowtime = nowtime + 60
    End If
    If nowtime - starttime > 30 Then 
        Goto begin
    End If
Wend

//检测到鱼上钩，拉杆操作
Rem success
//点击右键，拉杆
RightClick 1
//等待自动拾取
Delay 1000 + Int(Rnd * 3000)


//正常结束，重新开始
Goto begin



//结束标记
Rem endflag



