[General]
SyntaxVersion=2
BeginHotkey=122
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=f6413567-22fe-4957-ab0b-53896864814d
Description=fishing_5.0
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=FishForm
[Relative]
SetupOCXFile=
[Comment]
使用前准备：
1. 鼠标落到鱼漂右下方，快捷键截图，默认F8,不要使浮漂高亮
2. 清空颜色，选择羽毛或者轻木取色
使用说明：
1. 钓鱼技能拖到底部的动作条中
2. 在游戏 系统 设置 UI缩放 使得动作条钓鱼图标在35x35像素左右
3. 设置拾取方式为自动拾取
4. 游戏设置为全屏
5. 到水边站好，调整到第一视角
6. 调整视野，使得远处水和陆地或者和天空的分界线在视野的上三分之一处
7. 调整视野用右键调整，使得你的人物是正对视野的
8. 减少插件，增加界面整洁程度
9. 根据光影，寻找浮漂和水的颜色区别较大的地方和角度
9. 后台启动钓鱼辅助，使用快捷键，开始和停止
10.钓鱼的时候，不要动鼠标。但是可以用键盘自由的聊天
11.怀旧服使用

[UIPackage]
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


[Script]
//LogStart "fishing.log"
Function CheckLicense(filepath)
    mc = Lib.Yozoraの命令库.MachineCode()
    到期时间 = Lib.Yozoraの命令库.验证License(mc, "FISH", filepath)
    当前时间 = Lib.Yozoraの命令库.获取网站时间("www.baidu.com")
	TracePrint "网络获取时间："&当前时间
    If TypeName(当前时间) = "Integer" Then
        当前时间=Date
    End If
    If TypeName(到期时间) = "Integer" Then
        FishForm.Label7.Caption = "未注册"
        FishForm.Label7.BackColor = "0000FF"
        CheckLicense = 0
        Exit Function
    End If
    If TypeName(到期时间) = "Date" Then 
        剩余天数 = DateDiff("d", 当前时间, 到期时间)
        If 剩余天数 < 0 Then 
            FishForm.Label7.Caption="已过期"
            FishForm.Label7.BackColor = "00FFFF"
            CheckLicense = 1
        Else 
            FishForm.Label7.Caption="已注册"
            FishForm.Label7.BackColor = "00FF00"
            CheckLicense = 2
        End If
        FishForm.Label9.Caption = "有效期至：" & license(1) & "-" & license(2) & "-" & license(3)
    End If
End Function
Event FishForm.Load
    //    LogStart "fishing.log"
    FishForm.InputBox2.Text = Lib.Yozoraの命令库.MachineCode()
    FishForm.Hotkey_ScrShot.Register True
    CheckLicense("fishing.lic")
End Event  
//清空羽毛颜色
Event FishForm.Button1.Click
    FishForm.Label1.Caption=""
End Event
//清空轻木颜色
Event FishForm.Button2.Click
    FishForm.Label2.Caption=""
End Event
Event FishForm.Hotkey_ScrShot.Change  
    FishForm.Hotkey_ScrShot.Register True    
End Event
//机器码显示框禁止修改
Event FishForm.InputBox2.Change
    FishForm.InputBox2.Text = Lib.Yozoraの命令库.MachineCode()
End Event
Event FishForm.Hotkey_ScrShot.Hotkey  
    GetCursorPos mx, my
    Call Plugin.Pic.PrintScreen(mx - 80, my - 50, mx, my, "fishing.tmp.bmp")
    Call Plugin.File.DeleteFile("fishing.tmp2.bmp")
    VBSBegin
        Dim Img 'As ImageFile
        Dim IP 'As ImageProcess
        Set Img = CreateObject("WIA.ImageFile")
        Set IP = CreateObject("WIA.ImageProcess")
        Img.LoadFile "fishing.tmp.bmp"
        IP.Filters.Add IP.FilterInfos("Scale").FilterID
        IP.Filters(1).Properties("MaximumWidth") = 160
        IP.Filters(1).Properties("MaximumHeight") = 100
        Set Img = IP.Apply(Img)
        Img.SaveFile "fishing.tmp2.bmp"
    VBSEnd
    FishForm.PictureBox1.Picture="fishing.tmp2.bmp"
End Event
Event FishForm.PictureBox1.Click   
    GetCursorPos mx, my
    mcolor = Plugin.Color.GetPixelColor(mx, my, 0)
    If FishForm.OptionBox1.Value = 1 Then 
        //羽毛
        If FishForm.Label1.Caption = "" Then 
            FishForm.Label1.Caption = mcolor
        Else 
            FishForm.Label1.Caption = FishForm.Label1.Caption & "|" & mcolor
        End If
    ElseIf FishForm.OptionBox2.Value = 1 Then
        //轻木
        If FishForm.Label2.Caption = "" Then 
            FishForm.Label2.Caption = mcolor
        Else 
            FishForm.Label2.Caption = FishForm.Label2.Caption & "|" & mcolor
        End If
    End If  
End Event  
Function NaturalNumber(txt)
    newtext = txt
    For i = 1 To len(txt) 
        tt = Asc(mid(txt, i, 1))
        If tt < 48 or tt > 57 Then 
            newtext = Replace(newtext, Chr(tt), "")
        End If
    Next
    NaturalNumber=newtext
End Function
Event FishForm.InputBox1.Change   
    FishForm.InputBox1.Text=NaturalNumber(FishForm.InputBox1.Text)
End Event
Event FishForm.InputBox3.Change   
    FishForm.InputBox3.Text=NaturalNumber(FishForm.InputBox3.Text)
End Event
//全局使用的变量
scrw = Plugin.Sys.GetScRX()
scrh = Plugin.Sys.GetScRY()
//------------------------------------------------
//函数定义
//------------------------------------------------
Dim FeatherX
Dim FeatherY
Function FindFeather(x1, y1, x2, y2, colors)
    FindFeather = -1
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 1, 0.8, x, y
        If x > 0 And y > 0 Then
            FindFeather = i
            FeatherX = x
            FeatherY = y
            //MessageBox FindX
            Exit Function
        End If
    Next
End Function
Function Find(x1, y1, x2, y2, colors)
    Find = -1
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 1, 0.8, x, y
        If x > 0 And y > 0 Then
            Find = i
            Exit Function
        End If
    Next
End Function
Dim YellowCorkWoodX
Dim YellowCorkWoodY
Function FindYellowCorkWood(x1, y1, x2, y2, colors)
    FindYellowCorkWood = - 1 
    SUMX = 0
    SUMY = 0
    SUMN = 0
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 2, 0.8, x, y
        If x > 0 And y > 0 Then
            SUMX = SUMX + x
            SUMY = SUMY + y
            SUMN = SUMN + 1
        End If
    Next
    If SUMX > 0 And SUMY > 0 And SUMN > 0 Then 
        FindYellowCorkWood = SUMN    
        YellowCorkWoodX = Int(SUMX / SUMN)
        YellowCorkWoodY = Int(SUMY / SUMN)
    End If
End Function
//检查是否设置颜色
If FishForm.Label1.Caption = "" or FishForm.Label2.Caption = "" Then 
    MessageBox "请先设置颜色！"
    Goto endflag
End If
//浮漂的红色羽毛
aRedFeather = Split(FishForm.Label1.Caption, "|")
//浮漂的黄色轻木
aYellowCorkWood = Split(FishForm.Label2.Caption, "|")
Timeout = Int(FishForm.InputBox1.Text)
If Timeout = "" Then 
    MessageBox "请设置正确的运行时长！"
    Goto endflag
End If
//最大连续失败次数
Times = Int(FishForm.InputBox3.Text)
If Times = "" Then 
    MessageBox "请设置正确的连续失败次数！"
    Goto endflag
End If
curtimes=Times
//------------------------------------------------
//配置查找色
//------------------------------------------------
RUN_START_TIME = Plugin.Sys.GetTime()
Timeout = Timeout * 60 * 1000
//循环开始
Rem begin
//验证是否注册
If Not CheckLicense("fishing.lic") = 2 Then 
    MessageBox "注册信息验证失败"
    Goto endflag
End If
//判断游戏是否运行，且是否激活窗口
FHwnd = Plugin.Window.Foreground()   
WHwnd = Plugin.Window.Find(0, "魔兽世界")
sWindow = Plugin.Window.IsWindow(WHwnd)
If sWindow = 0 Or not FHwnd = WHwnd  Then 
    MessageBox "当前不是魔兽世界窗口！"
    Goto endflag
End If
//设置勿扰
If FishForm.CheckBoxSetDND.Value = 1 And HasSetDND = 0 Then 
    KeyPress "Enter", 1
    Delay 500 + Int(Rnd * 500)
    SayString "/dnd 暂离"
    Delay 500 + Int(Rnd * 500)
    KeyPress "Enter", 1
    HasSetDND = 1
End If
//判断最大失败次数
If not curtimes > 0  Then 
    TracePrint "达到最大连续失败次数，结束运行！"
    Goto endflag
End If
curtimes=curtimes-1
//判断连续运行时间
If Plugin.Sys.GetTime() - RUN_START_TIME > Timeout Then 
    TracePrint  "运行时间到，结束运行！"
    Goto endflag
End If
//鼠标移动到右下角
MoveTo scrw - 200 - Int(Rnd * 50), scrh - 200 - Int(Rnd * 50)
Delay 1000 + Int(Rnd * 1000)
//点击钓鱼快捷键
KeyPress FishForm.Hotkey_fish.VirtualKey,FishForm.Hotkey_fish.Modifiers
Delay 1500 + Int(Rnd * 1500)
//
//FindPic 0, Int(scrh * 3 / 4), scrw, scrh, "Attachment:\fishlogo.bmp", 0.5, intX, intY
//If intX > 0 And intY > 0 Then 
//    MoveTo intX + Int(Rnd * 10),intY + Int(Rnd * 10)
//    LeftClick 1
//    Delay 1500 + Int(Rnd * 1500)
//    //    MoveTo Int(Rnd * 1000), Int(Rnd * 500)
//Else 
//    MessageBox "没找到钓鱼图标，请拖到下方动作条！"
//    Goto endflag
//End If
//
//
//暴力查找浮漂的循环
//For msx = 800 To 400 Step -20
//    For msy = 600 To 250 Step -1
//        MoveTo msx, msy
//        ms = GetCursorShape(0)
//        //如果找到鱼漂就跳出
//        If ms = 1884068285 Then Goto wait
//    Next
//Next
//Rem wait
//Delay 1000 + Int(Rnd * 2000)
//找浮漂红色部分
rx1 = Int(scrw / 3)
ry1 = Int(scrh / 3)
rx2 = Int(scrw * 2 / 3)
ry2 = Int(scrh - 200)
F = FindFeather(rx1, ry1, rx2, ry2, aRedFeather)
If F >= 0 Then 
    //鼠标如果进行了这个移动操作，说明找到红色羽毛了
    //鼠标移动到浮漂附近
    MoveTo FeatherX, FeatherY + 100 + Int(Rnd * 50)
    Delay 500 + Int(Rnd * 500)
    //浮漂黄色部分
    F = FindYellowCorkWood(FeatherX, FeatherY, FeatherX + 50, FeatherY + 50, aYellowCorkWood)
    If F >= 0 Then 
        MoveTo YellowCorkWoodX, YellowCorkWoodY
    End If
End If
Delay Int(Rnd * 1000)
//通过检测鼠标样式，判断鼠标是否落在浮漂上
ms = GetCursorShape(0)
If Not ms = 1884068285  Then Goto begin
Dim YCWHColor(1)
YCWHColor(0) = Plugin.Color.GetPixelColor(YellowCorkWoodX, YellowCorkWoodY-2, 0)
YCWHColor(1) = Plugin.Color.GetPixelColor(YellowCorkWoodX, YellowCorkWoodY-1, 0)
starttime = Plugin.Sys.GetTime()
While True
    F = Find(YellowCorkWoodX - 5, YellowCorkWoodY - 5, YellowCorkWoodX + 5, YellowCorkWoodY + 5, YCWHColor)
    If F < 0  Then 
        Goto success
    End If
    //如果没鱼上钩，30秒后重新抛竿
    nowtime = Plugin.Sys.GetTime()
    If nowtime - starttime > 30000 Then 
        Goto begin
    End If
Wend
//检测到鱼上钩，拉杆操作
Rem success
//点击右键，拉杆
RightClick 1
//等待自动拾取
Delay 1000 + Int(Rnd * 3000)
//刷新最大连续失败次数
curtimes=Times
//正常结束，重新开始
Goto begin
//-------------------------------------
//结束标记
//-----------------------
Rem endflag
If FishForm.CheckBox3.Value = 1 Then 
    TracePrint "结束后炉石"
    KeyPress "Enter", 1
    Delay 500 + Int(Rnd * 500)
    SayString "/cast 炉石"
    Delay 500 + Int(Rnd * 500)
    KeyPress "Enter", 1
    Delay 20000 + Int(Rnd * 20000)
End If
If FishForm.CheckBox1.Value = 1 Then 
    TracePrint "结束后关机"
    Call Plugin.Sys.ExitOS(1)
End If
