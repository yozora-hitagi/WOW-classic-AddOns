[General]
SyntaxVersion=2
BeginHotkey=122
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=f6413567-22fe-4957-ab0b-53896864814d
Description=fishing_5.0
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=FishForm
[Relative]
SetupOCXFile=
[Comment]
使用前准备：
1. 鼠标落到鱼漂右下方，快捷键截图，默认F8,不要使浮漂高亮
2. 清空颜色，选择羽毛或者轻木取色
使用说明：
1. 钓鱼技能拖到底部的动作条中
2. 在游戏 系统 设置 UI缩放 使得动作条钓鱼图标在35x35像素左右
3. 设置拾取方式为自动拾取
4. 游戏设置为全屏
5. 到水边站好，调整到第一视角
6. 调整视野，使得远处水和陆地或者和天空的分界线在视野的上三分之一处
7. 调整视野用右键调整，使得你的人物是正对视野的
8. 减少插件，增加界面整洁程度
9. 根据光影，寻找浮漂和水的颜色区别较大的地方和角度
9. 后台启动钓鱼辅助，使用快捷键，开始和停止
10.钓鱼的时候，不要动鼠标。但是可以用键盘自由的聊天
11.怀旧服使用

[UIPackage]
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


[Script]
//LogStart "fishing.log"
Function CheckLicense(filepath)
    mc = Lib.Yozoraの命令库.MachineCode()
    到期时间 = Lib.Yozoraの命令库.验证License(mc, "FISH", filepath)
    当前时间 = Lib.网络.获取网络时间_增强版("www.baidu.com")
    If TypeName(当前时间) = "Integer" Then 
        当前时间=Date
    End If
    If TypeName(到期时间) = "Integer" Then
        FishForm.Label7.Caption = "未注册"
        FishForm.Label7.BackColor = "0000FF"
        CheckLicense = 0
        Exit Function
    End If
    If TypeName(到期时间) = "Date" Then 
        剩余天数 = DateDiff("d", 当前时间, 到期时间)
        If 剩余天数 < 0 Then 
            FishForm.Label7.Caption="已过期"
            FishForm.Label7.BackColor = "00FFFF"
            CheckLicense = 1
        Else 
            FishForm.Label7.Caption="已注册"
            FishForm.Label7.BackColor = "00FF00"
            CheckLicense = 2
        End If
        FishForm.Label9.Caption = "有效期至：" & license(1) & "-" & license(2) & "-" & license(3)
    End If
End Function
Event FishForm.Load
    //    LogStart "fishing.log"
    FishForm.InputBox2.Text = Lib.Yozoraの命令库.MachineCode()
    FishForm.Hotkey_ScrShot.Register True
    CheckLicense("fishing.lic")
End Event  
//清空羽毛颜色
Event FishForm.Button1.Click
    FishForm.Label1.Caption=""
End Event
//清空轻木颜色
Event FishForm.Button2.Click
    FishForm.Label2.Caption=""
End Event
Event FishForm.Hotkey_ScrShot.Change  
    FishForm.Hotkey_ScrShot.Register True    
End Event
//机器码显示框禁止修改
Event FishForm.InputBox2.Change
    FishForm.InputBox2.Text = Lib.Yozoraの命令库.MachineCode()
End Event
Event FishForm.Hotkey_ScrShot.Hotkey  
    GetCursorPos mx, my
    Call Plugin.Pic.PrintScreen(mx - 80, my - 50, mx, my, "fishing.tmp.bmp")
    Call Plugin.File.DeleteFile("fishing.tmp2.bmp")
    VBSBegin
        Dim Img 'As ImageFile
        Dim IP 'As ImageProcess
        Set Img = CreateObject("WIA.ImageFile")
        Set IP = CreateObject("WIA.ImageProcess")
        Img.LoadFile "fishing.tmp.bmp"
        IP.Filters.Add IP.FilterInfos("Scale").FilterID
        IP.Filters(1).Properties("MaximumWidth") = 160
        IP.Filters(1).Properties("MaximumHeight") = 100
        Set Img = IP.Apply(Img)
        Img.SaveFile "fishing.tmp2.bmp"
    VBSEnd
    FishForm.PictureBox1.Picture="fishing.tmp2.bmp"
End Event
Event FishForm.PictureBox1.Click   
    GetCursorPos mx, my
    mcolor = Plugin.Color.GetPixelColor(mx, my, 0)
    If FishForm.OptionBox1.Value = 1 Then 
        //羽毛
        If FishForm.Label1.Caption = "" Then 
            FishForm.Label1.Caption = mcolor
        Else 
            FishForm.Label1.Caption = FishForm.Label1.Caption & "|" & mcolor
        End If
    ElseIf FishForm.OptionBox2.Value = 1 Then
        //轻木
        If FishForm.Label2.Caption = "" Then 
            FishForm.Label2.Caption = mcolor
        Else 
            FishForm.Label2.Caption = FishForm.Label2.Caption & "|" & mcolor
        End If
    End If  
End Event  
Function NaturalNumber(txt)
    newtext = txt
    For i = 1 To len(txt) 
        tt = Asc(mid(txt, i, 1))
        If tt < 48 or tt > 57 Then 
            newtext = Replace(newtext, Chr(tt), "")
        End If
    Next
    NaturalNumber=newtext
End Function
Event FishForm.InputBox1.Change   
    FishForm.InputBox1.Text=NaturalNumber(FishForm.InputBox1.Text)
End Event
Event FishForm.InputBox3.Change   
    FishForm.InputBox3.Text=NaturalNumber(FishForm.InputBox3.Text)
End Event
//全局使用的变量
scrw = Plugin.Sys.GetScRX()
scrh = Plugin.Sys.GetScRY()
//------------------------------------------------
//函数定义
//------------------------------------------------
Dim FeatherX
Dim FeatherY
Function FindFeather(x1, y1, x2, y2, colors)
    FindFeather = -1
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 1, 0.8, x, y
        If x > 0 And y > 0 Then
            FindFeather = i
            FeatherX = x
            FeatherY = y
            //MessageBox FindX
            Exit Function
        End If
    Next
End Function
Function Find(x1, y1, x2, y2, colors)
    Find = -1
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 1, 0.8, x, y
        If x > 0 And y > 0 Then
            Find = i
            Exit Function
        End If
    Next
End Function
Dim YellowCorkWoodX
Dim YellowCorkWoodY
Function FindYellowCorkWood(x1, y1, x2, y2, colors)
    FindYellowCorkWood = - 1 
    SUMX = 0
    SUMY = 0
    SUMN = 0
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 2, 0.8, x, y
        If x > 0 And y > 0 Then
            SUMX = SUMX + x
            SUMY = SUMY + y
            SUMN = SUMN + 1
        End If
    Next
    If SUMX > 0 And SUMY > 0 And SUMN > 0 Then 
        FindYellowCorkWood = SUMN    
        YellowCorkWoodX = Int(SUMX / SUMN)
        YellowCorkWoodY = Int(SUMY / SUMN)
    End If
End Function
//检查是否设置颜色
If FishForm.Label1.Caption = "" or FishForm.Label2.Caption = "" Then 
    MessageBox "请先设置颜色！"
    Goto endflag
End If
//浮漂的红色羽毛
aRedFeather = Split(FishForm.Label1.Caption, "|")
//浮漂的黄色轻木
aYellowCorkWood = Split(FishForm.Label2.Caption, "|")
Timeout = Int(FishForm.InputBox1.Text)
If Timeout = "" Then 
    MessageBox "请设置正确的运行时长！"
    Goto endflag
End If
//最大连续失败次数
Times = Int(FishForm.InputBox3.Text)
If Times = "" Then 
    MessageBox "请设置正确的连续失败次数！"
    Goto endflag
End If
curtimes=Times
//------------------------------------------------
//配置查找色
//------------------------------------------------
RUN_START_TIME = Plugin.Sys.GetTime()
Timeout = Timeout * 60 * 1000
//循环开始
Rem begin
//验证是否注册
If Not CheckLicense("fishing.lic") = 2 Then 
    MessageBox "注册信息验证失败"
    Goto endflag
End If
//判断游戏是否运行，且是否激活窗口
FHwnd = Plugin.Window.Foreground()   
WHwnd = Plugin.Window.Find(0, "魔兽世界")
sWindow = Plugin.Window.IsWindow(WHwnd)
If sWindow = 0 Or not FHwnd = WHwnd  Then 
    MessageBox "当前不是魔兽世界窗口！"
    Goto endflag
End If
//设置勿扰
If FishForm.CheckBoxSetDND.Value = 1 And HasSetDND = 0 Then 
    KeyPress "Enter", 1
    Delay 500 + Int(Rnd * 500)
    SayString "/dnd 暂离"
    Delay 500 + Int(Rnd * 500)
    KeyPress "Enter", 1
    HasSetDND = 1
End If
//判断最大失败次数
If not curtimes > 0  Then 
    TracePrint "达到最大连续失败次数，结束运行！"
    Goto endflag
End If
curtimes=curtimes-1
//判断连续运行时间
If Plugin.Sys.GetTime() - RUN_START_TIME > Timeout Then 
    TracePrint  "运行时间到，结束运行！"
    Goto endflag
End If
//鼠标移动到右下角
MoveTo scrw - 200 - Int(Rnd * 50), scrh - 200 - Int(Rnd * 50)
Delay 1000 + Int(Rnd * 1000)
//点击钓鱼快捷键
KeyPress FishForm.Hotkey_fish.VirtualKey,FishForm.Hotkey_fish.Modifiers
Delay 1500 + Int(Rnd * 1500)
//
//FindPic 0, Int(scrh * 3 / 4), scrw, scrh, "Attachment:\fishlogo.bmp", 0.5, intX, intY
//If intX > 0 And intY > 0 Then 
//    MoveTo intX + Int(Rnd * 10),intY + Int(Rnd * 10)
//    LeftClick 1
//    Delay 1500 + Int(Rnd * 1500)
//    //    MoveTo Int(Rnd * 1000), Int(Rnd * 500)
//Else 
//    MessageBox "没找到钓鱼图标，请拖到下方动作条！"
//    Goto endflag
//End If
//
//
//暴力查找浮漂的循环
//For msx = 800 To 400 Step -20
//    For msy = 600 To 250 Step -1
//        MoveTo msx, msy
//        ms = GetCursorShape(0)
//        //如果找到鱼漂就跳出
//        If ms = 1884068285 Then Goto wait
//    Next
//Next
//Rem wait
//Delay 1000 + Int(Rnd * 2000)
//找浮漂红色部分
rx1 = Int(scrw / 3)
ry1 = Int(scrh / 3)
rx2 = Int(scrw * 2 / 3)
ry2 = Int(scrh - 200)
F = FindFeather(rx1, ry1, rx2, ry2, aRedFeather)
If F >= 0 Then 
    //鼠标如果进行了这个移动操作，说明找到红色羽毛了
    //鼠标移动到浮漂附近
    MoveTo FeatherX, FeatherY + 100 + Int(Rnd * 50)
    Delay 500 + Int(Rnd * 500)
    //浮漂黄色部分
    F = FindYellowCorkWood(FeatherX, FeatherY, FeatherX + 50, FeatherY + 50, aYellowCorkWood)
    If F >= 0 Then 
        MoveTo YellowCorkWoodX, YellowCorkWoodY
    End If
End If
Delay Int(Rnd * 1000)
//通过检测鼠标样式，判断鼠标是否落在浮漂上
ms = GetCursorShape(0)
If Not ms = 1884068285  Then Goto begin
Dim YCWHColor(1)
YCWHColor(0) = Plugin.Color.GetPixelColor(YellowCorkWoodX, YellowCorkWoodY-2, 0)
YCWHColor(1) = Plugin.Color.GetPixelColor(YellowCorkWoodX, YellowCorkWoodY-1, 0)
starttime = Plugin.Sys.GetTime()
While True
    F = Find(YellowCorkWoodX - 5, YellowCorkWoodY - 5, YellowCorkWoodX + 5, YellowCorkWoodY + 5, YCWHColor)
    If F < 0  Then 
        Goto success
    End If
    //如果没鱼上钩，30秒后重新抛竿
    nowtime = Plugin.Sys.GetTime()
    If nowtime - starttime > 30000 Then 
        Goto begin
    End If
Wend
//检测到鱼上钩，拉杆操作
Rem success
//点击右键，拉杆
RightClick 1
//等待自动拾取
Delay 1000 + Int(Rnd * 3000)
//刷新最大连续失败次数
curtimes=Times
//正常结束，重新开始
Goto begin
//-------------------------------------
//结束标记
//-----------------------
Rem endflag
If FishForm.CheckBox3.Value = 1 Then 
    TracePrint "结束后炉石"
    KeyPress "Enter", 1
    Delay 500 + Int(Rnd * 500)
    SayString "/cast 炉石"
    Delay 500 + Int(Rnd * 500)
    KeyPress "Enter", 1
    Delay 20000 + Int(Rnd * 20000)
End If
If FishForm.CheckBox1.Value = 1 Then 
    TracePrint "结束后关机"
    Call Plugin.Sys.ExitOS(1)
End If
