[General]
SyntaxVersion=2
BeginHotkey=122
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=f6413567-22fe-4957-ab0b-53896864814d
Description=fishing_5.0
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=FishForm
[Relative]
SetupOCXFile=
[Comment]
使用前准备：
1. 鼠标落到鱼漂右下方，快捷键截图，默认F8,不要使浮漂高亮
2. 清空颜色，选择羽毛或者轻木取色
使用说明：
1. 钓鱼技能拖到底部的动作条中
2. 在游戏 系统 设置 UI缩放 使得动作条钓鱼图标在35x35像素左右
3. 设置拾取方式为自动拾取
4. 游戏设置为全屏
5. 到水边站好，调整到第一视角
6. 调整视野，使得远处水和陆地或者和天空的分界线在视野的上三分之一处
7. 调整视野用右键调整，使得你的人物是正对视野的
8. 减少插件，增加界面整洁程度
9. 根据光影，寻找浮漂和水的颜色区别较大的地方和角度
9. 后台启动钓鱼辅助，使用快捷键，开始和停止
10.钓鱼的时候，不要动鼠标。但是可以用键盘自由的聊天
11.怀旧服使用

[UIPackage]
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


[Script]
//LogStart "fishing.log"
Function CheckLicense(filepath)
    mc = Lib.Yozoraの命令库.MachineCode()
    到期时间 = Lib.Yozoraの命令库.验证License(mc, "FISH", filepath)
    当前时间 = Lib.Yozoraの命令库.获取网站时间("www.baidu.com")
	TracePrint "网络获取时间："&当前时间
    If TypeName(当前时间) = "Integer" Then
        当前时间=Date
    End If
    If TypeName(到期时间) = "Integer" Then
        FishForm.Label7.Caption = "未注册"
        FishForm.Label7.BackColor = "0000FF"
        CheckLicense = 0
        Exit Function
    End If
    If TypeName(到期时间) = "Date" Then 
        剩余天数 = DateDiff("d", 当前时间, 到期时间)
        If 剩余天数 < 0 Then 
            FishForm.Label7.Caption="已过期"
            FishForm.Label7.BackColor = "00FFFF"
            CheckLicense = 1
        Else 
            FishForm.Label7.Caption="已注册"
            FishForm.Label7.BackColor = "00FF00"
            CheckLicense = 2
        End If
        FishForm.Label9.Caption = "有效期至：" & license(1) & "-" & license(2) & "-" & license(3)
    End If
End Function
Event FishForm.Load
    //    LogStart "fishing.log"
    FishForm.InputBox2.Text = Lib.Yozoraの命令库.MachineCode()
    FishForm.Hotkey_ScrShot.Register True
    CheckLicense("fishing.lic")
End Event  
//清空羽毛颜色
Event FishForm.Button1.Click
    FishForm.Label1.Caption=""
End Event
//清空轻木颜色
Event FishForm.Button2.Click
    FishForm.Label2.Caption=""
End Event
Event FishForm.Hotkey_ScrShot.Change  
    FishForm.Hotkey_ScrShot.Register True    
End Event
//机器码显示框禁止修改
Event FishForm.InputBox2.Change
    FishForm.InputBox2.Text = Lib.Yozoraの命令库.MachineCode()
End Event


Event FishForm.Hotkey_ScrShot.Hotkey  
    GetCursorPos mx, my
    Call Plugin.Pic.PrintScreen(mx - 80, my - 50, mx, my, "fishing.tmp.bmp")
    Call Plugin.File.DeleteFile("fishing.tmp2.bmp")
    VBSBegin
        Dim Img 'As ImageFile
        Dim IP 'As ImageProcess
        Set Img = CreateObject("WIA.ImageFile")
        Set IP = CreateObject("WIA.ImageProcess")
        Img.LoadFile "fishing.tmp.bmp"
        IP.Filters.Add IP.FilterInfos("Scale").FilterID
        IP.Filters(1).Properties("MaximumWidth") = 160
        IP.Filters(1).Properties("MaximumHeight") = 100
        Set Img = IP.Apply(Img)
        Img.SaveFile "fishing.tmp2.bmp"
    VBSEnd
    FishForm.PictureBox1.Picture="fishing.tmp2.bmp"
End Event
Event FishForm.PictureBox1.Click   
    GetCursorPos mx, my
    mcolor = Plugin.Color.GetPixelColor(mx, my, 0)
    If FishForm.OptionBox1.Value = 1 Then 
        //羽毛
        If FishForm.Label1.Caption = "" Then 
            FishForm.Label1.Caption = mcolor
        Else 
            FishForm.Label1.Caption = FishForm.Label1.Caption & "|" & mcolor
        End If
    ElseIf FishForm.OptionBox2.Value = 1 Then
        //轻木
        If FishForm.Label2.Caption = "" Then 
            FishForm.Label2.Caption = mcolor
        Else 
            FishForm.Label2.Caption = FishForm.Label2.Caption & "|" & mcolor
        End If
    End If  
End Event  
Function NaturalNumber(txt)
    newtext = txt
    For i = 1 To len(txt) 
        tt = Asc(mid(txt, i, 1))
        If tt < 48 or tt > 57 Then 
            newtext = Replace(newtext, Chr(tt), "")
        End If
    Next
    NaturalNumber=newtext
End Function
Event FishForm.InputBox1.Change   
    FishForm.InputBox1.Text=NaturalNumber(FishForm.InputBox1.Text)
End Event
Event FishForm.InputBox3.Change   
    FishForm.InputBox3.Text=NaturalNumber(FishForm.InputBox3.Text)
End Event
//全局使用的变量
scrw = Plugin.Sys.GetScRX()
scrh = Plugin.Sys.GetScRY()
//------------------------------------------------
//函数定义
//------------------------------------------------
Dim FeatherX
Dim FeatherY
Function FindFeather(x1, y1, x2, y2, colors)
    FindFeather = -1
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 1, 0.8, x, y
        If x > 0 And y > 0 Then
            FindFeather = i
            FeatherX = x
            FeatherY = y
            //MessageBox FindX
            Exit Function
        End If
    Next
End Function
Function Find(x1, y1, x2, y2, colors)
    Find = -1
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 1, 0.8, x, y
        If x > 0 And y > 0 Then
            Find = i
            Exit Function
        End If
    Next
End Function
Dim YellowCorkWoodX
Dim YellowCorkWoodY
Function FindYellowCorkWood(x1, y1, x2, y2, colors)
    FindYellowCorkWood = - 1 
    SUMX = 0
    SUMY = 0
    SUMN = 0
    For i = 0 To UBound(colors)
        FindColorEx x1, y1, x2, y2, colors(i), 2, 0.8, x, y
        If x > 0 And y > 0 Then
            SUMX = SUMX + x
            SUMY = SUMY + y
            SUMN = SUMN + 1
        End If
    Next
    If SUMX > 0 And SUMY > 0 And SUMN > 0 Then 
        FindYellowCorkWood = SUMN    
        YellowCorkWoodX = Int(SUMX / SUMN)
        YellowCorkWoodY = Int(SUMY / SUMN)
    End If
End Function
//检查是否设置颜色
If FishForm.Label1.Caption = "" or FishForm.Label2.Caption = "" Then 
    MessageBox "请先设置颜色！"
    Goto endflag
End If
//浮漂的红色羽毛
aRedFeather = Split(FishForm.Label1.Caption, "|")
//浮漂的黄色轻木
aYellowCorkWood = Split(FishForm.Label2.Caption, "|")
Timeout = Int(FishForm.InputBox1.Text)
If Timeout = "" Then 
    MessageBox "请设置正确的运行时长！"
    Goto endflag
End If
//最大连续失败次数
Times = Int(FishForm.InputBox3.Text)
If Times = "" Then 
    MessageBox "请设置正确的连续失败次数！"
    Goto endflag
End If
curtimes=Times
//------------------------------------------------
//配置查找色
//------------------------------------------------
RUN_START_TIME = Plugin.Sys.GetTime()
Timeout = Timeout * 60 * 1000




//循环开始
Rem begin
//验证是否注册
If Not CheckLicense("fishing.lic") = 2 Then 
    MessageBox "注册信息验证失败"
    Goto endflag
End If
//判断游戏是否运行，且是否激活窗口
FHwnd = Plugin.Window.Foreground()   
WHwnd = Plugin.Window.Find(0, "魔兽世界")
sWindow = Plugin.Window.IsWindow(WHwnd)
If sWindow = 0 Or not FHwnd = WHwnd  Then 
    MessageBox "当前不是魔兽世界窗口！"
    Goto endflag
End If
//设置勿扰
If FishForm.CheckBoxSetDND.Value = 1 And HasSetDND = 0 Then 
    KeyPress "Enter", 1
    Delay 500 + Int(Rnd * 500)
    SayString "/dnd 暂离"
    Delay 500 + Int(Rnd * 500)
    KeyPress "Enter", 1
    HasSetDND = 1
End If
//判断最大失败次数
If not curtimes > 0  Then 
    TracePrint "达到最大连续失败次数，结束运行！"
    Goto endflag
End If
curtimes=curtimes-1
//判断连续运行时间
If Plugin.Sys.GetTime() - RUN_START_TIME > Timeout Then 
    TracePrint  "运行时间到，结束运行！"
    Goto endflag
End If


//鼠标移动到右下角
MoveTo scrw - 200 - Int(Rnd * 50), scrh - 200 - Int(Rnd * 50)
Delay 1000 + Int(Rnd * 1000)
//点击钓鱼快捷键
KeyPress FishForm.Hotkey_fish.VirtualKey,FishForm.Hotkey_fish.Modifiers
Delay 1500 + Int(Rnd * 1500)
//
//FindPic 0, Int(scrh * 3 / 4), scrw, scrh, "Attachment:\fishlogo.bmp", 0.5, intX, intY
//If intX > 0 And intY > 0 Then 
//    MoveTo intX + Int(Rnd * 10),intY + Int(Rnd * 10)
//    LeftClick 1
//    Delay 1500 + Int(Rnd * 1500)
//    //    MoveTo Int(Rnd * 1000), Int(Rnd * 500)
//Else 
//    MessageBox "没找到钓鱼图标，请拖到下方动作条！"
//    Goto endflag
//End If
//
//
//暴力查找浮漂的循环
//For msx = 800 To 400 Step -20
//    For msy = 600 To 250 Step -1
//        MoveTo msx, msy
//        ms = GetCursorShape(0)
//        //如果找到鱼漂就跳出
//        If ms = 1884068285 Then Goto wait
//    Next
//Next
//Rem wait
//Delay 1000 + Int(Rnd * 2000)
//找浮漂红色部分
rx1 = Int(scrw / 3)
ry1 = Int(scrh / 3)
rx2 = Int(scrw * 2 / 3)
ry2 = Int(scrh - 200)
F = FindFeather(rx1, ry1, rx2, ry2, aRedFeather)
If F >= 0 Then 
    //鼠标如果进行了这个移动操作，说明找到红色羽毛了
    //鼠标移动到浮漂附近
    MoveTo FeatherX, FeatherY + 100 + Int(Rnd * 50)
    Delay 500 + Int(Rnd * 500)
    //浮漂黄色部分
    F = FindYellowCorkWood(FeatherX, FeatherY, FeatherX + 50, FeatherY + 50, aYellowCorkWood)
    If F >= 0 Then 
        MoveTo YellowCorkWoodX, YellowCorkWoodY
    End If
End If
Delay Int(Rnd * 1000)
//通过检测鼠标样式，判断鼠标是否落在浮漂上
ms = GetCursorShape(0)
If Not ms = 1884068285  Then Goto begin
Dim YCWHColor(1)
YCWHColor(0) = Plugin.Color.GetPixelColor(YellowCorkWoodX, YellowCorkWoodY-2, 0)
YCWHColor(1) = Plugin.Color.GetPixelColor(YellowCorkWoodX, YellowCorkWoodY-1, 0)
starttime = Plugin.Sys.GetTime()
While True
    F = Find(YellowCorkWoodX - 5, YellowCorkWoodY - 5, YellowCorkWoodX + 5, YellowCorkWoodY + 5, YCWHColor)
    If F < 0  Then 
        Goto success
    End If
    //如果没鱼上钩，30秒后重新抛竿
    nowtime = Plugin.Sys.GetTime()
    If nowtime - starttime > 30000 Then 
        Goto begin
    End If
Wend
//检测到鱼上钩，拉杆操作
Rem success
//点击右键，拉杆
RightClick 1
//等待自动拾取
Delay 1000 + Int(Rnd * 3000)
//刷新最大连续失败次数
curtimes=Times
//正常结束，重新开始
Goto begin
//-------------------------------------
//结束标记
//-----------------------
Rem endflag
If FishForm.CheckBox3.Value = 1 Then 
    TracePrint "结束后炉石"
    KeyPress "Enter", 1
    Delay 500 + Int(Rnd * 500)
    SayString "/cast 炉石"
    Delay 500 + Int(Rnd * 500)
    KeyPress "Enter", 1
    Delay 20000 + Int(Rnd * 20000)
End If
If FishForm.CheckBox1.Value = 1 Then 
    TracePrint "结束后关机"
    Call Plugin.Sys.ExitOS(1)
End If
